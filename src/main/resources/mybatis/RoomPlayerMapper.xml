<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lvwyh.mapper.RoomPlayerMapper">
    <resultMap id="RoomPlayerMap" type="com.lvwyh.entity.RoomPlayer">
        <id property="id" column="id" />
        <result property="roomId" column="room_id" />
        <result property="playerId" column="player_id" />
        <result property="entryTime" column="entry_time" />
    </resultMap>

    <insert id="insert" parameterType="com.lvwyh.entity.RoomPlayer" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO room_player (room_id, player_id, entry_time)
        VALUES (#{roomId}, #{playerId}, #{entryTime})
    </insert>

    <insert id="batchInsert">
        INSERT INTO room_player (room_id, player_id, entry_time)
        VALUES
        <foreach collection="list" item="it" separator=",">
            (#{it.roomId}, #{it.playerId}, #{it.entryTime})
        </foreach>
    </insert>

    <select id="selectById" resultMap="RoomPlayerMap">
        SELECT id, room_id, player_id, entry_time
        FROM room_player
        WHERE id = #{id}
    </select>

    <select id="selectByRoomId" resultMap="RoomPlayerMap">
        SELECT id, room_id, player_id, entry_time
        FROM room_player
        WHERE room_id = #{roomId}
        ORDER BY id DESC
    </select>

    <select id="selectPlayersInRoom" resultType="map">
        SELECT p.player_id AS playerId, p.player_name AS playerName, p.create_time AS createTime,
               rp.entry_time AS entryTime
        FROM room_player rp
                 JOIN player p ON p.player_id = rp.player_id
        WHERE rp.room_id = #{roomId}
        ORDER BY rp.id DESC
    </select>

    <update id="update" parameterType="com.lvwyh.entity.RoomPlayer">
        UPDATE room_player
        SET room_id = #{roomId},
            player_id = #{playerId},
            entry_time = #{entryTime}
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM room_player WHERE id = #{id}
    </delete>

    <delete id="deleteByRoomIdAndPlayerId">
        DELETE FROM room_player WHERE room_id = #{roomId} AND player_id = #{playerId}
    </delete>

    <delete id="deleteByRoomId">
        DELETE FROM room_player WHERE room_id = #{roomId}
    </delete>

    <delete id="deleteByPlayerId">
        DELETE FROM room_player WHERE player_id = #{playerId}
    </delete>
</mapper>
