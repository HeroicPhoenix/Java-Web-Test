<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lvwyh.mapper.ValidationRuleLibraryMapper">

    <insert id="insertRule" parameterType="com.lvwyh.entity.ValidationRuleEntry" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO validation_rule_entry(rule_name, rule_category, rule_expression, description, created_at)
        VALUES(#{ruleName}, #{ruleCategory}, #{ruleExpression}, #{description}, #{createdAt})
    </insert>

    <select id="queryRules" resultType="com.lvwyh.entity.ValidationRuleEntry">
        SELECT id,
               rule_name AS ruleName,
               rule_category AS ruleCategory,
               rule_expression AS ruleExpression,
               description,
               created_at AS createdAt
        FROM validation_rule_entry
        <where>
            <if test="ruleCategory != null and ruleCategory != ''">
                AND rule_category = #{ruleCategory}
            </if>
            <if test="keyword != null and keyword != ''">
                AND (rule_name LIKE CONCAT('%', #{keyword}, '%') OR description LIKE CONCAT('%', #{keyword}, '%'))
            </if>
        </where>
        ORDER BY created_at DESC
    </select>

    <delete id="deleteRule">
        DELETE FROM validation_rule_entry
        WHERE id = #{ruleId}
    </delete>

</mapper>
